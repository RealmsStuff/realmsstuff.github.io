<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DevLog // Code & Modding</title>
    
    <!-- Libraries -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">
    <!-- Syntax Highlighting -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">
    
    <style>
        :root {
            --bg-dark: #0b0b0f;
            --bg-card: #16161d;
            --text-main: #e2e8f0;
            --text-muted: #94a3b8;
            --accent: #a78bfa;
            --accent-glow: rgba(167, 139, 250, 0.2);
            --code-bg: #011627;
            --border: #2d2d39;
        }

        * { box-sizing: border-box; }
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-main);
            margin: 0;
            line-height: 1.6;
            background-image: 
                radial-gradient(circle at 0% 0%, #1a1a2e 0%, transparent 40%),
                radial-gradient(circle at 100% 100%, #161021 0%, transparent 40%);
            background-attachment: fixed;
        }

        .container { max-width: 900px; margin: 0 auto; padding: 40px 20px; }

        /* --- Navigation --- */
        nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 60px;
        }
        .logo { font-weight: 800; font-size: 1.2rem; letter-spacing: -1px; cursor: pointer; }
        .logo span { color: var(--accent); }
        .nav-links a { color: var(--text-muted); text-decoration: none; margin-left: 20px; font-size: 0.9rem; transition: 0.2s; }
        .nav-links a:hover { color: var(--accent); }

        /* --- Post Grid --- */
        .post-grid { display: grid; gap: 25px; }
        .post-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            padding: 30px;
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .post-card:hover {
            transform: translateY(-4px);
            border-color: var(--accent);
            box-shadow: 0 10px 30px -10px var(--accent-glow);
        }
        .post-meta { font-size: 0.8rem; color: var(--accent); font-weight: 600; text-transform: uppercase; margin-bottom: 10px; display: block; }
        .post-card h2 { margin: 0 0 10px 0; font-size: 1.5rem; }
        .post-card p { color: var(--text-muted); margin: 0; }

        /* --- Post Reader (Markdown View) --- */
        #reader { display: none; animation: fadeIn 0.4s ease; }
        .back-btn {
            background: none; border: 1px solid var(--border); color: var(--text-muted);
            padding: 8px 16px; border-radius: 8px; cursor: pointer; margin-bottom: 30px;
            transition: 0.2s;
        }
        .back-btn:hover { border-color: var(--accent); color: var(--accent); }

        /* Markdown Styling */
        .md-content h1 { font-size: 2.5rem; margin-bottom: 0.5rem; }
        .md-content h2 { color: var(--accent); margin-top: 2rem; border-bottom: 1px solid var(--border); padding-bottom: 10px; }
        .md-content p { color: #cbd5e1; font-size: 1.1rem; }
        
        /* Code Styling */
        pre[class*="language-"] {
            border-radius: 12px;
            margin: 25px 0;
            border: 1px solid var(--border) !important;
            background: var(--code-bg) !important;
        }
        code { font-family: 'Fira Code', monospace !important; }

        /* Custom "File Tree" Component for MD */
        .file-tree {
            background: #000;
            padding: 15px;
            border-radius: 8px;
            font-family: monospace;
            border-left: 3px solid var(--accent);
            margin: 20px 0;
        }

        footer { text-align: center; margin-top: 100px; color: var(--text-muted); font-size: 0.8rem; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Mobile */
        @media (max-width: 600px) { h1 { font-size: 2rem; } }
    </style>
</head>
<body>

<div class="container">
    <nav>
        <div class="logo" onclick="showFeed()">CODE<span>//</span>HUB</div>
        <div class="nav-links">
            <a href="#">Projects</a>
            <a href="https://github.com/">GitHub</a>
        </div>
    </nav>

    <!-- FEED VIEW -->
    <div id="feed">
        <header style="margin-bottom: 40px;">
            <h1 style="font-size: 3rem; margin-bottom: 0;">DevLog</h1>
            <p style="color: var(--text-muted);">Documenting game modding, reverse engineering, and tools.</p>
        </header>
        <div class="post-grid" id="post-list">
            <!-- Posts injected here -->
        </div>
    </div>

    <!-- READER VIEW -->
    <div id="reader">
        <button class="back-btn" onclick="showFeed()"><i class="fa-solid fa-arrow-left"></i> Back to Feed</button>
        <div id="post-content" class="md-content"></div>
    </div>

    <footer>
        &copy; 2026 Captivity Hub. Powered by Markdown and Hormones.
    </footer>
</div>

<!-- Scripts -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/marked/4.3.0/marked.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-csharp.min.js"></script>

<script>
    /* --- CONFIGURATION --- */
    const GITHUB_USER = 'YOUR_GITHUB_USERNAME'; // Change this!
    const GITHUB_REPO = 'YOUR_REPO_NAME';     // Change this!
    const POSTS_DIR = 'posts';

    async function fetchPosts() {
        const listElement = document.getElementById('post-list');
        const spinner = document.getElementById('loading-spinner');
        
        try {
            // 1. Get list of files in /posts/ folder
            const response = await fetch(`https://api.github.com/repos/${GITHUB_USER}/${GITHUB_REPO}/contents/${POSTS_DIR}`);
            const files = await response.json();
            
            // 2. Filter for only .md files
            const mdFiles = files.filter(file => file.name.endsWith('.md'));

            for (let file of mdFiles) {
                // 3. Fetch the content of each file to get metadata (Title/Date)
                const rawResponse = await fetch(file.download_url);
                const text = await rawResponse.text();
                const metadata = parseMetadata(text);
                
                // 4. Create the post card
                const card = document.createElement('div');
                card.className = 'post-card';
                card.onclick = () => loadPost(file.download_url, file.name);
                card.innerHTML = `
                    <span class="post-meta">${metadata.date || 'Recent'}</span>
                    <h2>${metadata.title || file.name}</h2>
                    <p>${metadata.excerpt || 'Click to read more...'}</p>
                `;
                listElement.appendChild(card);
            }
            spinner.style.display = 'none';
        } catch (error) {
            spinner.innerText = "Error loading posts. Check GitHub config.";
            console.error(error);
        }
    }

    function parseMetadata(text) {
        const meta = {};
        const match = text.match(/^---([\s\S]*?)---/);
        if (match) {
            const lines = match[1].split('\n');
            lines.forEach(line => {
                const [key, ...value] = line.split(':');
                if (key && value) meta[key.trim()] = value.join(':').trim();
            });
        }
        return meta;
    }

    async function loadPost(url, filename) {
        document.getElementById('feed').style.display = 'none';
        document.getElementById('reader').style.display = 'block';
        document.getElementById('post-content').innerHTML = "Loading content...";

        const response = await fetch(url);
        let text = await response.text();
        
        // Remove the metadata (Frontmatter) from the display
        text = text.replace(/^---[\s\S]*?---/, '');

        document.getElementById('post-content').innerHTML = marked.parse(text);
        Prism.highlightAll();
        
        window.location.hash = filename;
        window.scrollTo(0,0);
    }

    function showFeed() {
        document.getElementById('feed').style.display = 'block';
        document.getElementById('reader').style.display = 'none';
        window.location.hash = '';
    }

    // Initialize
    fetchPosts();
    
    // Handle direct links
    if(window.location.hash) {
        const hash = window.location.hash.replace('#', '');
        const rawUrl = `https://raw.githubusercontent.com/${GITHUB_USER}/${GITHUB_REPO}/main/${POSTS_DIR}/${hash}`;
        loadPost(rawUrl, hash);
    }
</script>
</body>
</html>
